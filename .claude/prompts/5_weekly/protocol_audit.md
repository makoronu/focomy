# 週次プロトコル監査

**週1回実行: 直近の変更に対してプロトコル違反をチェック**

---

## 手順

### 1. 直近1週間のコミット取得

```bash
git log --oneline --since="1 week ago"
```

### 2. 変更ファイル一覧取得

```bash
git diff --name-only HEAD~20  # または適切な範囲
```

### 3. 各ファイルをチェック

---

## チェックリスト

### 絶対禁止（1つでもあれば修正必須）

| 項目 | grepパターン例 |
|------|----------------|
| ENUM型 | `class.*Enum` |
| マジックナンバー | `== [0-9]+` （コンテキスト確認） |
| マジックストリング | `== ['"].*['"]` （定数化されてないもの） |
| ハードコードURL | `https?://` （設定外） |
| ハードコード認証 | `api_key`, `password`, `secret` |
| 物理削除 | `DELETE FROM`, `.delete()` |
| 例外握りつぶし | `except:.*pass`, `except Exception:` （ログなし） |
| N+1クエリ | ループ内のDB呼び出し |
| SELECT * | `SELECT \*` |

### セキュリティ

| 項目 | 確認方法 |
|------|----------|
| SQLインジェクション | f-string内のSQL |
| XSS | escape()なしのユーザー入力出力 |
| 入力バリデーション | リクエストの直接使用 |

### 強く非推奨

| 項目 | 基準 |
|------|------|
| 巨大関数 | 100行超え |
| ネスト深い | 4段以上 |
| 引数多い | 10個以上 |

---

## 出力フォーマット

```
━━━━━━━━━━━━━━━━━━━━
【週次監査】YYYY-MM-DD
━━━━━━━━━━━━━━━━━━━━
対象コミット: N件
対象ファイル: N件

【違反】
- [ファイル:行] 違反内容

【修正】
- コミット: [hash] "[message]"

【結果】
✓ 違反なし / ✗ N件修正
━━━━━━━━━━━━━━━━━━━━
```

---

## 違反発見時

1. 違反箇所を特定
2. 修正コミット作成
3. 必要ならデプロイ
