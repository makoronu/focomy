# WordPress ãƒ•ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ è¨ˆç”» v4ï¼ˆå®Œå…¨ç‰ˆï¼‰

## æ¦‚è¦
WordPressã‚µã‚¤ãƒˆã‹ã‚‰å®Œå…¨ç§»è¡Œã€‚ãƒ‡ãƒ¼ã‚¿ã€ãƒ¡ãƒ‡ã‚£ã‚¢ã€URLæ§‹é€ ã™ã¹ã¦ã‚’ä¿æŒã—ã€SEOã‚’æãªã‚ãªã„ç§»è¡Œã‚’å®Ÿç¾ã€‚

---

## è¨­è¨ˆåŸå‰‡

1. **ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§**: 1ä»¶ã‚‚å–ã‚Šã“ã¼ã•ãªã„ã€‚å¤±æ•—ã—ãŸã‚‰ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
2. **SEOç¶™ç¶šæ€§**: URLå¤‰æ›´æ™‚ã¯è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€‚æ¤œç´¢é †ä½ã‚’è½ã¨ã•ãªã„
3. **æ®µéšçš„ç§»è¡Œ**: åˆ†æ â†’ ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†’ æœ¬ç•ªåæ˜ 
4. **å¾©å…ƒå¯èƒ½**: ã„ã¤ã§ã‚‚å…ƒã®çŠ¶æ…‹ã«æˆ»ã›ã‚‹
5. **å·®åˆ†å¯¾å¿œ**: è¿½åŠ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€æ›´æ–°ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¯¾å¿œ
6. **æ¤œè¨¼å¯èƒ½**: ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
7. **å†é–‹å¯èƒ½**: é€”ä¸­ã§å¤±æ•—ã—ã¦ã‚‚ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å†é–‹

---

## ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯¾è±¡ï¼ˆå®Œå…¨ç‰ˆï¼‰

### ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿
| é …ç›® | WordPress | Focomy | å‚™è€ƒ |
|------|-----------|--------|------|
| æŠ•ç¨¿ | wp_posts (post) | post | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·å«ã‚€ |
| å›ºå®šãƒšãƒ¼ã‚¸ | wp_posts (page) | page | éšå±¤æ§‹é€ ç¶­æŒ |
| ãƒ¡ãƒ‡ã‚£ã‚¢ | wp_posts (attachment) | media | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å®Œå…¨ç§»è¡Œ |
| ã‚«ãƒ†ã‚´ãƒª | wp_terms | category | éšå±¤æ§‹é€ ç¶­æŒ |
| ã‚¿ã‚° | wp_terms | tag | - |
| ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¯ã‚½ãƒãƒŸãƒ¼ | wp_terms | å‹•çš„ç”Ÿæˆ | ä»»æ„ã®ã‚¿ã‚¯ã‚½ãƒãƒŸãƒ¼ã«å¯¾å¿œ |
| ã‚³ãƒ¡ãƒ³ãƒˆ | wp_comments | comment | éšå±¤ï¼ˆè¿”ä¿¡ï¼‰å¯¾å¿œã€ã‚¹ãƒ‘ãƒ ãƒ•ã‚£ãƒ«ã‚¿ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ | wp_users | user | ãƒ­ãƒ¼ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚° |
| ãƒ¡ãƒ‹ãƒ¥ãƒ¼ | wp_terms + wp_postmeta | menu_item | éšå±¤ã€ã‚«ã‚¹ã‚¿ãƒ ãƒªãƒ³ã‚¯ |
| ãƒªãƒ“ã‚¸ãƒ§ãƒ³ | wp_posts (revision) | revision | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
| ã‚´ãƒŸç®± | wp_posts (trash) | - | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |

### ã‚«ã‚¹ã‚¿ãƒ æŠ•ç¨¿ã‚¿ã‚¤ãƒ—
| é …ç›® | å¯¾å¿œ | å‚™è€ƒ |
|------|------|------|
| ä»»æ„ã®ã‚«ã‚¹ã‚¿ãƒ æŠ•ç¨¿ã‚¿ã‚¤ãƒ— | âœ“ | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—è‡ªå‹•ç”Ÿæˆ |
| ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆpostmetaï¼‰ | âœ“ | å‹æ¨è«–ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾© |
| ã‚¿ã‚¯ã‚½ãƒãƒŸãƒ¼ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âœ“ | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•ç”Ÿæˆ |

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿
| ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ | å¯¾å¿œ | ç§»è¡Œå†…å®¹ |
|-----------|------|---------|
| Yoast SEO | âœ“ | title, description, focus keyword, social |
| All in One SEO | âœ“ | title, description |
| Rank Math | âœ“ | title, description, focus keyword |
| ACF (Pro) | âœ“ | å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ— |
| ACF Repeater | âœ“ | repeaterãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¤‰æ› |
| ACF Flexible Content | âœ“ | flexibleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¤‰æ› |
| WPML | âœ“ | å¤šè¨€èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€è¨€èªãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| Polylang | âœ“ | å¤šè¨€èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€è¨€èªãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| Redirection | âœ“ | æ—¢å­˜ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ«ãƒ¼ãƒ«å®Œå…¨ç§»è¡Œ |
| TablePress | âœ“ | ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ› |
| WooCommerce | â–³ | å•†å“ãƒ‡ãƒ¼ã‚¿ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¦è¨­å®šï¼‰ |
| Contact Form 7 | â–³ | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆå†è¨­å®šå¿…è¦ï¼‰ |
| Gravity Forms | â–³ | ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ |
| Elementor | â–³ | HTMLã¨ã—ã¦ä¿å­˜ |

### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
| é …ç›® | å¯¾å¿œ | å‚™è€ƒ |
|------|------|------|
| æŠ•ç¨¿ãƒ¡ã‚¿ï¼ˆ_wp_* ä»¥å¤–ï¼‰ | âœ“ | ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ |
| æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ | âœ“ | alt, title, caption, description |
| ç”»åƒã‚µã‚¤ã‚ºæƒ…å ± | âœ“ | width, height, mime_type |
| EXIF/IPTC | âœ“ | æ’®å½±æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

---

## Phase 0: äº‹å‰åˆ†æï¼ˆå¼·åŒ–ç‰ˆï¼‰

### 0.1 ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```python
class DataSourceType(Enum):
    WXR = "wxr"           # WordPress eXtended RSSï¼ˆæ¨™æº–ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰
    REST_API = "rest_api"  # WP REST APIï¼ˆãƒªãƒ¢ãƒ¼ãƒˆï¼‰
    DIRECT_DB = "direct_db" # ç›´æ¥DBæ¥ç¶šï¼ˆé«˜é€Ÿã€å®Œå…¨ï¼‰


class DataSourceConfig:
    """ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š"""

    # WXR
    wxr_file: Path | None

    # REST API
    api_url: str | None
    api_username: str | None
    api_password: str | None  # Application Password

    # Direct DB
    db_host: str | None
    db_name: str | None
    db_user: str | None
    db_password: str | None
    table_prefix: str = "wp_"

    # å…±é€š
    media_base_url: str  # ãƒ¡ãƒ‡ã‚£ã‚¢ã®ãƒ™ãƒ¼ã‚¹URL
```

### 0.2 å®Œå…¨åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

```python
@dataclass
class AnalysisReport:
    # ã‚µã‚¤ãƒˆæƒ…å ±
    site_url: str
    site_name: str
    wp_version: str
    language: str

    # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„çµ±è¨ˆ
    posts: ContentStats
    pages: ContentStats
    attachments: ContentStats
    comments: ContentStats
    users: ContentStats
    revisions: ContentStats  # ãƒªãƒ“ã‚¸ãƒ§ãƒ³
    trash: ContentStats      # ã‚´ãƒŸç®±

    # ã‚¿ã‚¯ã‚½ãƒãƒŸãƒ¼
    categories: list[TaxonomyStats]
    tags: list[TaxonomyStats]
    custom_taxonomies: list[TaxonomyStats]

    # ã‚«ã‚¹ã‚¿ãƒ æŠ•ç¨¿ã‚¿ã‚¤ãƒ—
    custom_post_types: list[PostTypeStats]

    # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ¤œå‡º
    detected_plugins: list[PluginInfo]
    plugin_data: dict[str, PluginDataStats]

    # å¤šè¨€èª
    multilingual_plugin: str | None  # WPML, Polylang, etc
    languages: list[str]
    default_language: str

    # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ†æ
    custom_fields: list[CustomFieldAnalysis]
    acf_field_groups: list[ACFFieldGroup]

    # URLæ§‹é€ 
    permalink_structure: str
    category_base: str
    tag_base: str
    author_base: str
    trailing_slash: bool  # æœ«å°¾ã‚¹ãƒ©ãƒƒã‚·ãƒ¥

    # ãƒ¡ãƒ‡ã‚£ã‚¢åˆ†æ
    media_stats: MediaStats
    external_media: list[str]  # å¤–éƒ¨ãƒ›ã‚¹ãƒˆã®ç”»åƒ
    broken_media: list[str]    # ãƒªãƒ³ã‚¯åˆ‡ã‚Œ

    # ãƒªãƒ³ã‚¯åˆ†æ
    internal_links: int
    external_links: int
    broken_links: list[BrokenLink]

    # ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰åˆ†æ
    shortcodes: list[ShortcodeAnalysis]  # æ¤œå‡ºã—ãŸå…¨ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰

    # ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    existing_redirects: list[ExistingRedirect]  # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰ã®æ—¢å­˜ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    required_redirects: int

    # æ¨å®š
    estimated_time: str
    estimated_storage: str

    # è­¦å‘Šãƒ»ã‚¨ãƒ©ãƒ¼
    errors: list[AnalysisError]      # ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸å¯
    warnings: list[AnalysisWarning]  # æ³¨æ„ãŒå¿…è¦
    recommendations: list[str]       # æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³


@dataclass
class ShortcodeAnalysis:
    """ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰åˆ†æ"""
    name: str
    count: int
    sample_usages: list[str]
    conversion_status: str  # supported, partial, placeholder, unsupported
    conversion_notes: str


@dataclass
class CustomFieldAnalysis:
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆ†æçµæœ"""
    key: str
    count: int
    sample_values: list[Any]
    inferred_type: str  # string, number, boolean, json, serialized
    is_acf: bool
    acf_field_key: str | None
    post_types: list[str]  # ã©ã®æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹


@dataclass
class MediaStats:
    """ãƒ¡ãƒ‡ã‚£ã‚¢çµ±è¨ˆ"""
    total_count: int
    total_size: int  # bytes
    by_type: dict[str, int]  # image: 400, video: 20, etc
    by_year: dict[int, int]  # 2023: 150, 2024: 200
    largest_files: list[MediaInfo]
    missing_alt: int
    external_urls: list[str]
    encoding_issues: list[str]  # çµµæ–‡å­—ã€ç‰¹æ®Šæ–‡å­—å•é¡Œ
```

### 0.3 ã‚¹ãƒãƒ¼ãƒˆå‹æ¨è«–

```python
class FieldTypeInferrer:
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹ã‚’æ¨è«–"""

    def infer(self, values: list[Any]) -> FieldTypeSuggestion:
        """ã‚µãƒ³ãƒ—ãƒ«å€¤ã‹ã‚‰æœ€é©ãªå‹ã‚’æ¨è«–"""

        # ç©ºå€¤ã‚’é™¤å¤–
        non_empty = [v for v in values if v]
        if not non_empty:
            return FieldTypeSuggestion('string', confidence=0.5)

        # PHPã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
        decoded = [self._maybe_unserialize(v) for v in non_empty]

        # å‹åˆ¤å®š
        if all(isinstance(v, bool) for v in decoded):
            return FieldTypeSuggestion('boolean', confidence=1.0)

        if all(isinstance(v, int) for v in decoded):
            return FieldTypeSuggestion('number', confidence=1.0)

        if all(isinstance(v, float) for v in decoded):
            return FieldTypeSuggestion('float', confidence=1.0)

        if all(isinstance(v, list) for v in decoded):
            # ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ or ã‚®ãƒ£ãƒ©ãƒªãƒ¼
            if all(self._looks_like_image_ids(v) for v in decoded):
                return FieldTypeSuggestion('gallery', confidence=0.9)
            return FieldTypeSuggestion('repeater', confidence=0.8)

        if all(isinstance(v, dict) for v in decoded):
            return FieldTypeSuggestion('group', confidence=0.8)

        # æ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³
        if all(isinstance(v, str) for v in decoded):
            if all(self._is_email(v) for v in decoded):
                return FieldTypeSuggestion('email', confidence=1.0)
            if all(self._is_url(v) for v in decoded):
                return FieldTypeSuggestion('url', confidence=1.0)
            if all(self._is_date(v) for v in decoded):
                return FieldTypeSuggestion('date', confidence=0.9)
            if all(self._is_color(v) for v in decoded):
                return FieldTypeSuggestion('color', confidence=1.0)
            if all(len(v) > 500 for v in decoded):
                return FieldTypeSuggestion('text', confidence=0.8)

        return FieldTypeSuggestion('string', confidence=0.7)
```

### 0.4 åˆ†æUI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WordPress ã‚µã‚¤ãƒˆåˆ†æçµæœ                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  ğŸ“Š ã‚µã‚¤ãƒˆæ¦‚è¦                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ URL: https://example.com                                        â”‚ â”‚
â”‚  â”‚ WordPress: 6.4.2  |  è¨€èª: ja  |  ãƒ‘ãƒ¼ãƒãƒªãƒ³ã‚¯: /%postname%/    â”‚ â”‚
â”‚  â”‚ å¤šè¨€èª: WPML (ja, en, zh)                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“ˆ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„çµ±è¨ˆ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç¨®é¡          â”‚ ä»¶æ•°  â”‚ ã‚µã‚¤ã‚º     â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ æŠ•ç¨¿          â”‚ 523   â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ å›ºå®šãƒšãƒ¼ã‚¸    â”‚ 42    â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ãƒ¡ãƒ‡ã‚£ã‚¢      â”‚ 1,847 â”‚ 4.2GB      â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª      â”‚ 28    â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ã‚¿ã‚°          â”‚ 156   â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ã‚³ãƒ¡ãƒ³ãƒˆ      â”‚ 892   â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚ 12    â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ãƒ¡ãƒ‹ãƒ¥ãƒ¼      â”‚ 3     â”‚ -          â”‚ âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½        â”‚   â”‚
â”‚  â”‚ ãƒªãƒ“ã‚¸ãƒ§ãƒ³    â”‚ 2,340 â”‚ -          â”‚ â—‹ ã‚ªãƒ—ã‚·ãƒ§ãƒ³            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ product       â”‚ 156   â”‚ -          â”‚ âš  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ä½œæˆ  â”‚   â”‚
â”‚  â”‚ portfolio     â”‚ 34    â”‚ -          â”‚ âš  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ä½œæˆ  â”‚   â”‚
â”‚  â”‚ testimonial   â”‚ 18    â”‚ -          â”‚ âš  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ä½œæˆ  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  ğŸ”Œ æ¤œå‡ºã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ Yoast SEO                                                     â”‚ â”‚
â”‚  â”‚   â†’ SEOãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã—ã¾ã™ (523ä»¶)                           â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âœ“ Advanced Custom Fields PRO                                    â”‚ â”‚
â”‚  â”‚   â†’ 8ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¤œå‡º                               â”‚ â”‚
â”‚  â”‚   â†’ product_details (12ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰)                              â”‚ â”‚
â”‚  â”‚   â†’ portfolio_info (8ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰)                                â”‚ â”‚
â”‚  â”‚   â†’ ...                                                         â”‚ â”‚
â”‚  â”‚   â†’ [ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¢ºèª]                                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âœ“ WPML                                                          â”‚ â”‚
â”‚  â”‚   â†’ 3è¨€èª (ja, en, zh) ã‚’æ¤œå‡º                                   â”‚ â”‚
â”‚  â”‚   â†’ å¤šè¨€èªãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã—ã¾ã™                              â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âœ“ Redirection                                                   â”‚ â”‚
â”‚  â”‚   â†’ æ—¢å­˜ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ 45ä»¶ã‚’ç§»è¡Œã—ã¾ã™                           â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â–³ WooCommerce                                                   â”‚ â”‚
â”‚  â”‚   â†’ å•†å“: 156ä»¶ã€æ³¨æ–‡: 1,234ä»¶                                  â”‚ â”‚
â”‚  â”‚   â†’ å•†å“ãƒ‡ãƒ¼ã‚¿ã¯ç§»è¡Œå¯èƒ½ã€æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã¯æ‰‹å‹•ç¢ºèªãŒå¿…è¦            â”‚ â”‚
â”‚  â”‚   â†’ [WooCommerceç§»è¡Œã‚¬ã‚¤ãƒ‰]                                     â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â–³ Contact Form 7                                                â”‚ â”‚
â”‚  â”‚   â†’ 5ã¤ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¤œå‡º                                         â”‚ â”‚
â”‚  â”‚   â†’ Focomyã®ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã§å†ä½œæˆãŒå¿…è¦                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“ ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ãƒ¬ãƒãƒ¼ãƒˆ                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ [gallery] - 23ä»¶ â†’ Focomyã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›             â”‚ â”‚
â”‚  â”‚ âœ“ [caption] - 156ä»¶ â†’ ç”»åƒã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã«å¤‰æ›                    â”‚ â”‚
â”‚  â”‚ â–³ [contact-form-7] - 5ä»¶ â†’ ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«å¤‰æ›               â”‚ â”‚
â”‚  â”‚ â–³ [tablepress] - 12ä»¶ â†’ ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›                  â”‚ â”‚
â”‚  â”‚ âœ— [custom_shortcode] - 3ä»¶ â†’ æ‰‹å‹•å¯¾å¿œãŒå¿…è¦                     â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ [ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å¤‰æ›ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰]                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ”— URLãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ãƒ‘ãƒ¼ãƒãƒªãƒ³ã‚¯æ§‹é€ : /%postname%/ â†’ /blog/{slug}                   â”‚ â”‚
â”‚  â”‚ ãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥: ã‚ã‚Š â†’ ãªã—ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç”Ÿæˆï¼‰         â”‚ â”‚
â”‚  â”‚ ç”Ÿæˆã•ã‚Œã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: 765ä»¶                                    â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ æ—¢å­˜ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ (Redirection ãƒ—ãƒ©ã‚°ã‚¤ãƒ³): 45ä»¶                  â”‚ â”‚
â”‚  â”‚ â†’ ã™ã¹ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™                                        â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ ãƒªãƒ³ã‚¯åˆ‡ã‚Œæ¤œå‡º: 12ä»¶                                             â”‚ â”‚
â”‚  â”‚ â†’ [ãƒªãƒ³ã‚¯åˆ‡ã‚Œä¸€è¦§ã‚’ç¢ºèª]                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  âš  è­¦å‘Šãƒ»æ³¨æ„äº‹é …                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš  å¤–éƒ¨ãƒ›ã‚¹ãƒˆã®ç”»åƒãŒ23ä»¶ã‚ã‚Šã¾ã™                                â”‚ â”‚
â”‚  â”‚   â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨                â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âš  çµµæ–‡å­—ã‚’å«ã‚€æŠ•ç¨¿ãŒ15ä»¶ã‚ã‚Šã¾ã™                                â”‚ â”‚
â”‚  â”‚   â†’ UTF-8mb4ã§æ­£å¸¸ã«ç§»è¡Œã•ã‚Œã¾ã™                                â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âš  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã•ã‚ŒãŸæŠ•ç¨¿ãŒ5ä»¶ã‚ã‚Šã¾ã™                         â”‚ â”‚
â”‚  â”‚   â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ç§»è¡Œã•ã‚Œã¾ã›ã‚“ï¼ˆå†è¨­å®šãŒå¿…è¦ï¼‰                   â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ âš  äºˆç´„æŠ•ç¨¿ãŒ3ä»¶ã‚ã‚Šã¾ã™                                         â”‚ â”‚
â”‚  â”‚   â†’ å…¬é–‹æ—¥æ™‚ã¯ç¶­æŒã•ã‚Œã¾ã™                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â± æ¨å®šæ‰€è¦æ™‚é–“: 25åˆ†  |  å¿…è¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 4.5GB                      â”‚
â”‚                                                                       â”‚
â”‚  [ã‚«ã‚¹ã‚¿ãƒ æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã‚’ä½œæˆ]  [ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ã‚’å®Ÿè¡Œ]  [ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¨­å®šã¸]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³æ©Ÿèƒ½

### 1.1 ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³å®Ÿè¡Œ

```python
class DryRunImporter:
    """ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ - å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã›ãšã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""

    async def run(
        self,
        wxr_data: WXRData,
        options: ImportOptions,
    ) -> DryRunResult:
        """ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³å®Ÿè¡Œ"""

        result = DryRunResult()

        # æŠ•ç¨¿ã®å‡¦ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        for post in wxr_data.posts:
            try:
                # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                errors = await self._validate_post(post)
                if errors:
                    result.add_warning(post.id, errors)

                # ã‚¹ãƒ©ãƒƒã‚°é‡è¤‡ãƒã‚§ãƒƒã‚¯
                if await self._slug_exists('post', post.slug):
                    result.add_conflict(post.id, f"slug '{post.slug}' already exists")

                # URLå¤‰æ›´ãƒã‚§ãƒƒã‚¯
                old_url = self._extract_path(post.original_url)
                new_url = self._generate_new_url(post)
                if old_url != new_url:
                    result.add_redirect(old_url, new_url)

                # ãƒ¡ãƒ‡ã‚£ã‚¢å‚ç…§ãƒã‚§ãƒƒã‚¯
                media_refs = self._extract_media_references(post.content)
                for ref in media_refs:
                    if ref not in wxr_data.attachment_map:
                        result.add_warning(post.id, f"Missing media: {ref}")

                # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
                sanitize_warnings = self._check_content_safety(post.content)
                for warning in sanitize_warnings:
                    result.add_warning(post.id, warning)

                result.add_success('post', post.id, post.title)

            except Exception as e:
                result.add_error('post', post.id, str(e))

        # å†…éƒ¨ãƒªãƒ³ã‚¯ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
        await self._check_internal_links(wxr_data, result)

        return result


@dataclass
class DryRunResult:
    """ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³çµæœ"""
    success: dict[str, list]  # type -> [items]
    warnings: list[DryRunWarning]
    errors: list[DryRunError]
    conflicts: list[DryRunConflict]
    redirects: list[RedirectPreview]
    internal_link_fixes: list[LinkFix]
    security_warnings: list[SecurityWarning]  # XSSã€ãƒãƒ«ã‚¦ã‚§ã‚¢ç­‰

    def get_summary(self) -> dict:
        return {
            'will_import': {
                'posts': len(self.success.get('post', [])),
                'pages': len(self.success.get('page', [])),
                'media': len(self.success.get('media', [])),
                'categories': len(self.success.get('category', [])),
                'tags': len(self.success.get('tag', [])),
            },
            'warnings': len(self.warnings),
            'errors': len(self.errors),
            'conflicts': len(self.conflicts),
            'redirects': len(self.redirects),
            'link_fixes': len(self.internal_link_fixes),
            'security_warnings': len(self.security_warnings),
        }
```

### 1.2 ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```python
class PreviewImporter:
    """æ•°ä»¶ã ã‘å®Ÿéš›ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"""

    async def preview(
        self,
        wxr_data: WXRData,
        options: ImportOptions,
        preview_count: int = 3,
    ) -> PreviewResult:
        """ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ"""

        # ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆå¾Œã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ï¼‰
        async with self.db.begin_nested() as savepoint:
            result = PreviewResult()

            # æœ€åˆã®æ•°ä»¶ã ã‘ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
            for post in wxr_data.posts[:preview_count]:
                entity = await self._import_single(post)
                result.add_preview(entity, self._generate_preview_url(entity))

            # ã‚³ãƒŸãƒƒãƒˆã›ãšã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã‚’è¿”ã™
            result.preview_session_id = await self._save_preview_session(savepoint)

            return result

    async def confirm_preview(self, session_id: str) -> None:
        """ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºå®šã—ã¦ã‚³ãƒŸãƒƒãƒˆ"""
        await self._commit_preview_session(session_id)

    async def discard_preview(self, session_id: str) -> None:
        """ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç ´æ£„ã—ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯"""
        await self._rollback_preview_session(session_id)
```

### 1.3 ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³çµæœUI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³çµæœ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç¨®é¡          â”‚ ä»¶æ•°  â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ æŠ•ç¨¿          â”‚ 520   â”‚ âœ“ OK                                 â”‚   â”‚
â”‚  â”‚ å›ºå®šãƒšãƒ¼ã‚¸    â”‚ 42    â”‚ âœ“ OK                                 â”‚   â”‚
â”‚  â”‚ ãƒ¡ãƒ‡ã‚£ã‚¢      â”‚ 1,847 â”‚ âœ“ OK (4.2GB ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰äºˆå®š)        â”‚   â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª      â”‚ 28    â”‚ âœ“ OK                                 â”‚   â”‚
â”‚  â”‚ ã‚¿ã‚°          â”‚ 156   â”‚ âœ“ OK                                 â”‚   â”‚
â”‚  â”‚ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ  â”‚ 765   â”‚ âœ“ è‡ªå‹•ç”Ÿæˆ                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  âš  è­¦å‘Š (12ä»¶)                                    [è©³ç´°ã‚’è¡¨ç¤º â–¼]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ æŠ•ç¨¿ã€Œæ˜¥ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã€: å¤–éƒ¨ç”»åƒ (imgur.com) ã‚’å‚ç…§         â”‚ â”‚
â”‚  â”‚   â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã™                        â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â€¢ æŠ•ç¨¿ã€Œè£½å“Aã€: ACFãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã«ç©ºã®è¡ŒãŒå«ã¾ã‚Œã¦ã„ã¾ã™           â”‚ â”‚
â”‚  â”‚   â†’ ç©ºã®è¡Œã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™                                    â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â€¢ å›ºå®šãƒšãƒ¼ã‚¸ã€ŒãŠå•ã„åˆã‚ã›ã€: Contact Form 7 ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰      â”‚ â”‚
â”‚  â”‚   â†’ ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«å¤‰æ›ã•ã‚Œã¾ã™                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Š (2ä»¶)                        [è©³ç´°ã‚’è¡¨ç¤º â–¼]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ æŠ•ç¨¿ã€ŒãŠçŸ¥ã‚‰ã›ã€: ä¸å¯©ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œå‡º                      â”‚ â”‚
â”‚  â”‚   â†’ ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¦å®‰å…¨ãªå½¢å¼ã«å¤‰æ›ã—ã¾ã™                        â”‚ â”‚
â”‚  â”‚   â†’ [å†…å®¹ã‚’ç¢ºèª]                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  âš¡ ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆ (3ä»¶)                            [è©³ç´°ã‚’è¡¨ç¤º â–¼]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ slug "about" ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™                                  â”‚ â”‚
â”‚  â”‚   â†’ å¯¾å‡¦: â—‹ ã‚¹ã‚­ãƒƒãƒ—  â—‹ ä¸Šæ›¸ã  â— ãƒªãƒãƒ¼ãƒ  (about-2)           â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â€¢ slug "contact" ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™                                â”‚ â”‚
â”‚  â”‚   â†’ å¯¾å‡¦: â—‹ ã‚¹ã‚­ãƒƒãƒ—  â—‹ ä¸Šæ›¸ã  â— ãƒªãƒãƒ¼ãƒ  (contact-2)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ”— å†…éƒ¨ãƒªãƒ³ã‚¯ä¿®æ­£ (234ä»¶)                        [è©³ç´°ã‚’è¡¨ç¤º â–¼]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä»¥ä¸‹ã®å†…éƒ¨ãƒªãƒ³ã‚¯ãŒè‡ªå‹•çš„ã«æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™:                      â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â€¢ /2024/01/new-product/ â†’ /blog/new-product                     â”‚ â”‚
â”‚  â”‚ â€¢ /category/news/ â†’ /blog/category/news                         â”‚ â”‚
â”‚  â”‚ â€¢ /about-us/ â†’ /page/about-us                                   â”‚ â”‚
â”‚  â”‚ â€¢ ...                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  [æˆ»ã‚‹]  [ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œ (3ä»¶)]  [è¨­å®šã‚’ä¿®æ­£]      [ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 2: å·®åˆ†ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

### 2.1 å·®åˆ†æ¤œå‡º

```python
class DiffDetector:
    """WPã¨Focomyã®å·®åˆ†ã‚’æ¤œå‡º"""

    async def detect(
        self,
        wxr_data: WXRData,
        db: AsyncSession,
    ) -> DiffResult:
        """å·®åˆ†ã‚’æ¤œå‡º"""

        result = DiffResult()

        for post in wxr_data.posts:
            # WP IDã§æ—¢å­˜ã‚’æ¤œç´¢
            existing = await self._find_by_wp_id('post', post.id)

            if not existing:
                result.add_new('post', post)
            elif self._is_updated(existing, post):
                result.add_updated('post', post, existing)
            else:
                result.add_unchanged('post', post)

        # å‰Šé™¤æ¤œå‡ºï¼ˆFocomyã«ã‚ã‚‹ãŒã€WPã«ãªã„ã‚‚ã®ï¼‰
        focomy_wp_ids = await self._get_all_wp_ids('post')
        wxr_wp_ids = {p.id for p in wxr_data.posts}
        deleted_ids = focomy_wp_ids - wxr_wp_ids

        for wp_id in deleted_ids:
            entity = await self._find_by_wp_id('post', wp_id)
            result.add_deleted('post', entity)

        return result

    def _is_updated(self, existing: Entity, wp_post: WPPost) -> bool:
        """æ›´æ–°ãŒå¿…è¦ã‹åˆ¤å®š"""
        existing_data = self.entity_svc.serialize(existing)

        # æ›´æ–°æ—¥æ™‚ã§æ¯”è¼ƒ
        existing_modified = existing_data.get('wp_modified')
        if existing_modified and wp_post.post_modified:
            return wp_post.post_modified > existing_modified

        # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒƒã‚·ãƒ¥ã§æ¯”è¼ƒ
        existing_hash = existing_data.get('content_hash')
        new_hash = self._hash_content(wp_post.content)
        return existing_hash != new_hash


@dataclass
class DiffResult:
    new: dict[str, list]      # æ–°è¦
    updated: dict[str, list]  # æ›´æ–°ã‚ã‚Š
    unchanged: dict[str, list] # å¤‰æ›´ãªã—
    deleted: dict[str, list]  # WPã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸ
```

### 2.2 å·®åˆ†ã‚¤ãƒ³ãƒãƒ¼ãƒˆUI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·®åˆ†ã‚¤ãƒ³ãƒãƒ¼ãƒˆ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  å‰å›ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ: 2024-01-15 14:30                                   â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“Š å¤‰æ›´æ¤œå‡ºçµæœ                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç¨®é¡          â”‚ æ–°è¦  â”‚ æ›´æ–°  â”‚ å¤‰æ›´ãªã—â”‚ å‰Šé™¤  â”‚ æ“ä½œ           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ æŠ•ç¨¿          â”‚ 15    â”‚ 8     â”‚ 500   â”‚ 2     â”‚ [è©³ç´°]         â”‚ â”‚
â”‚  â”‚ å›ºå®šãƒšãƒ¼ã‚¸    â”‚ 2     â”‚ 3     â”‚ 37    â”‚ 0     â”‚ [è©³ç´°]         â”‚ â”‚
â”‚  â”‚ ãƒ¡ãƒ‡ã‚£ã‚¢      â”‚ 45    â”‚ 0     â”‚ 1,802 â”‚ 5     â”‚ [è©³ç´°]         â”‚ â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª      â”‚ 3     â”‚ 1     â”‚ 24    â”‚ 0     â”‚ [è©³ç´°]         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  âš™ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ–°è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„:                                                  â”‚ â”‚
â”‚  â”‚   â— ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹  â—‹ ã‚¹ã‚­ãƒƒãƒ—                                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ æ›´æ–°ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„:                                            â”‚ â”‚
â”‚  â”‚   â—‹ ä¸Šæ›¸ã  â— ãƒãƒ¼ã‚¸ï¼ˆæ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°ï¼‰  â—‹ ã‚¹ã‚­ãƒƒãƒ—   â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ WPã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„:                                      â”‚ â”‚
â”‚  â”‚   â—‹ Focomyã‹ã‚‰ã‚‚å‰Šé™¤  â—‹ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ç§»å‹•  â— ä½•ã‚‚ã—ãªã„         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]                                    [å·®åˆ†ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 3: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå¼·åŒ–ç‰ˆï¼‰

### 3.1 ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆï¼†å†é–‹æ©Ÿèƒ½

```python
class CheckpointManager:
    """ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç† - é€”ä¸­å†é–‹å¯¾å¿œ"""

    async def save_checkpoint(
        self,
        job_id: str,
        phase: str,
        progress: dict,
    ) -> None:
        """ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ä¿å­˜"""
        checkpoint = ImportCheckpoint(
            job_id=job_id,
            phase=phase,
            progress=progress,
            created_at=datetime.utcnow(),
        )
        await self.db.execute(
            insert(import_checkpoints).values(**asdict(checkpoint))
        )
        await self.db.commit()

    async def get_latest_checkpoint(self, job_id: str) -> ImportCheckpoint | None:
        """æœ€æ–°ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—"""
        result = await self.db.execute(
            select(ImportCheckpoint)
            .where(ImportCheckpoint.job_id == job_id)
            .order_by(ImportCheckpoint.created_at.desc())
            .limit(1)
        )
        return result.scalar_one_or_none()

    async def resume_from_checkpoint(
        self,
        job_id: str,
    ) -> ResumeContext:
        """ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å†é–‹"""
        checkpoint = await self.get_latest_checkpoint(job_id)
        if not checkpoint:
            raise ValueError(f"No checkpoint found for job {job_id}")

        return ResumeContext(
            phase=checkpoint.phase,
            skip_ids=checkpoint.progress.get('completed_ids', []),
            last_processed_id=checkpoint.progress.get('last_id'),
        )
```

### 3.2 ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–

```python
class BackgroundImportJob:
    """ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¸ãƒ§ãƒ–"""

    async def start(
        self,
        wxr_data: WXRData,
        options: ImportOptions,
    ) -> str:
        """ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹"""

        job_id = str(uuid.uuid4())

        # ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
        await self.queue.enqueue(
            'import_wordpress',
            job_id=job_id,
            wxr_data=wxr_data.serialize(),
            options=options.dict(),
        )

        return job_id

    async def get_status(self, job_id: str) -> JobStatus:
        """ã‚¸ãƒ§ãƒ–ã®çŠ¶æ…‹ã‚’å–å¾—"""
        job = await self.queue.get_job(job_id)

        return JobStatus(
            id=job_id,
            status=job.status,  # pending, running, completed, failed
            progress=job.progress,
            started_at=job.started_at,
            completed_at=job.completed_at,
            error=job.error,
        )

    async def cancel(self, job_id: str) -> None:
        """ã‚¸ãƒ§ãƒ–ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«"""
        await self.queue.cancel(job_id)

    async def schedule(
        self,
        wxr_data: WXRData,
        options: ImportOptions,
        scheduled_at: datetime,
    ) -> str:
        """ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ"""
        job_id = str(uuid.uuid4())

        await self.queue.enqueue_at(
            scheduled_at,
            'import_wordpress',
            job_id=job_id,
            wxr_data=wxr_data.serialize(),
            options=options.dict(),
        )

        return job_id
```

### 3.3 ä¸¦åˆ—å‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
class ParallelImporter:
    """ä¸¦åˆ—ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†"""

    def __init__(
        self,
        db: AsyncSession,
        max_workers: int = 10,
        batch_size: int = 50,
    ):
        self.db = db
        self.max_workers = max_workers
        self.batch_size = batch_size
        self.semaphore = asyncio.Semaphore(max_workers)
        self.checkpoint_mgr = CheckpointManager(db)

    async def import_all(
        self,
        wxr_data: WXRData,
        options: ImportOptions,
        progress: ProgressCallback,
        resume_context: ResumeContext | None = None,
    ) -> ImportResult:
        """å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""

        result = ImportResult()

        # Phase 1: ä¾å­˜ãªã—ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸¦åˆ—ï¼‰
        if not resume_context or resume_context.phase <= 'phase1':
            await asyncio.gather(
                self._import_users(wxr_data.authors, result, progress),
                self._import_categories(wxr_data.categories, result, progress),
                self._import_tags(wxr_data.tags, result, progress),
            )
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase1', result.to_dict()
            )

        # Phase 2: ãƒ¡ãƒ‡ã‚£ã‚¢ï¼ˆä¸¦åˆ—ã€ãŸã ã—å¸¯åŸŸåˆ¶é™ã‚ã‚Šï¼‰
        if not resume_context or resume_context.phase <= 'phase2':
            await self._import_media(wxr_data.attachments, result, progress, resume_context)
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase2', result.to_dict()
            )

        # Phase 3: æŠ•ç¨¿ãƒ»ãƒšãƒ¼ã‚¸ï¼ˆä¸¦åˆ—ã€ãŸã ã—ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰
        if not resume_context or resume_context.phase <= 'phase3':
            await asyncio.gather(
                self._import_posts(wxr_data.posts, result, progress, resume_context),
                self._import_pages(wxr_data.pages, result, progress, resume_context),
            )
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase3', result.to_dict()
            )

        # Phase 4: ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆæŠ•ç¨¿ã«ä¾å­˜ï¼‰
        if not resume_context or resume_context.phase <= 'phase4':
            await self._import_comments(wxr_data, result, progress)
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase4', result.to_dict()
            )

        # Phase 5: ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        if not resume_context or resume_context.phase <= 'phase5':
            await self._import_menus(wxr_data.nav_menus, result, progress)
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase5', result.to_dict()
            )

        # Phase 6: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        if not resume_context or resume_context.phase <= 'phase6':
            await self._import_redirects(wxr_data, result, progress)
            await self.checkpoint_mgr.save_checkpoint(
                options.job_id, 'phase6', result.to_dict()
            )

        # Phase 7: å†…éƒ¨ãƒªãƒ³ã‚¯ä¿®æ­£
        if not resume_context or resume_context.phase <= 'phase7':
            await self._fix_internal_links(result)

        return result

    async def _import_media(
        self,
        attachments: list[WPAttachment],
        result: ImportResult,
        progress: ProgressCallback,
        resume_context: ResumeContext | None = None,
    ):
        """ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""

        # å†é–‹æ™‚ã¯ã‚¹ã‚­ãƒƒãƒ—
        skip_ids = resume_context.skip_ids if resume_context else []
        attachments = [a for a in attachments if a.id not in skip_ids]

        # å¸¯åŸŸåˆ¶é™ä»˜ãä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        semaphore = asyncio.Semaphore(5)  # åŒæ™‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°åˆ¶é™

        async def download_one(attachment: WPAttachment):
            async with semaphore:
                try:
                    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    content = await self._download_media(attachment.url)

                    # WebPå¤‰æ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                    if self.options.convert_to_webp and attachment.mime_type.startswith('image/'):
                        content = await self._convert_to_webp(content)

                    # ç”»åƒæœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                    if self.options.optimize_images and attachment.mime_type.startswith('image/'):
                        content = await self._optimize_image(content)

                    # ä¿å­˜
                    entity = await self._save_media(attachment, content)
                    result.add_success('media', attachment.id, entity)

                except Exception as e:
                    result.add_error('media', attachment.id, str(e))

        # ãƒãƒƒãƒå‡¦ç†
        for i in range(0, len(attachments), self.batch_size):
            batch = attachments[i:i+self.batch_size]
            await asyncio.gather(*[download_one(a) for a in batch])
            await progress('media', i + len(batch), len(attachments))
```

### 3.4 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ‹ã‚¿ã‚¤ã‚º

```python
class ContentSanitizer:
    """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ‹ã‚¿ã‚¤ã‚º"""

    DANGEROUS_TAGS = ['script', 'iframe', 'object', 'embed', 'form']
    DANGEROUS_ATTRS = ['onclick', 'onerror', 'onload', 'onmouseover']

    def sanitize(self, content: str) -> tuple[str, list[SanitizeWarning]]:
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º"""
        warnings = []

        soup = BeautifulSoup(content, 'html.parser')

        # å±é™ºãªã‚¿ã‚°ã‚’é™¤å»
        for tag_name in self.DANGEROUS_TAGS:
            for tag in soup.find_all(tag_name):
                warnings.append(SanitizeWarning(
                    type='dangerous_tag',
                    detail=f"Removed <{tag_name}> tag",
                    original=str(tag)[:100],
                ))
                tag.decompose()

        # å±é™ºãªå±æ€§ã‚’é™¤å»
        for tag in soup.find_all():
            for attr in list(tag.attrs.keys()):
                if attr.lower() in self.DANGEROUS_ATTRS:
                    warnings.append(SanitizeWarning(
                        type='dangerous_attr',
                        detail=f"Removed {attr} attribute from <{tag.name}>",
                        original=f'{attr}="{tag[attr]}"'[:100],
                    ))
                    del tag[attr]

        # Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ€ªã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡º
        base64_pattern = re.compile(r'data:[^;]+;base64,[A-Za-z0-9+/=]{100,}')
        for match in base64_pattern.finditer(str(soup)):
            if self._is_suspicious_base64(match.group()):
                warnings.append(SanitizeWarning(
                    type='suspicious_base64',
                    detail="Suspicious base64 encoded content detected",
                    original=match.group()[:50] + '...',
                ))

        return str(soup), warnings

    def _is_suspicious_base64(self, data: str) -> bool:
        """Base64ãƒ‡ãƒ¼ã‚¿ãŒæ€ªã—ã„ã‹ãƒã‚§ãƒƒã‚¯"""
        try:
            decoded = base64.b64decode(data.split(',')[1])
            # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„å®Ÿè¡Œå¯èƒ½ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
            suspicious_patterns = [b'<script', b'javascript:', b'eval(', b'Function(']
            return any(p in decoded for p in suspicious_patterns)
        except:
            return False
```

### 3.5 å†…éƒ¨ãƒªãƒ³ã‚¯è‡ªå‹•ä¿®æ­£

```python
class InternalLinkFixer:
    """å†…éƒ¨ãƒªãƒ³ã‚¯ã‚’æ–°ã—ã„URLã«è‡ªå‹•æ›¸ãæ›ãˆ"""

    def __init__(self, url_map: dict[str, str]):
        # æ—§URL â†’ æ–°URL ã®ãƒãƒƒãƒ—
        self.url_map = url_map

    def fix_content(self, content: str) -> tuple[str, list[LinkFix]]:
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å†…ã®å†…éƒ¨ãƒªãƒ³ã‚¯ã‚’ä¿®æ­£"""
        fixes = []

        # HTMLãƒªãƒ³ã‚¯
        def replace_href(match):
            url = match.group(2)
            new_url = self._map_url(url)
            if new_url != url:
                fixes.append(LinkFix(url, new_url, 'href'))
                return f'{match.group(1)}"{new_url}"'
            return match.group(0)

        content = re.sub(r'(href=)"([^"]+)"', replace_href, content)

        # ç”»åƒsrc
        def replace_src(match):
            url = match.group(2)
            new_url = self._map_url(url)
            if new_url != url:
                fixes.append(LinkFix(url, new_url, 'src'))
                return f'{match.group(1)}"{new_url}"'
            return match.group(0)

        content = re.sub(r'(src=)"([^"]+)"', replace_src, content)

        # Gutenbergãƒªãƒ³ã‚¯
        def replace_gutenberg_url(match):
            try:
                attrs = json.loads(match.group(1))
                modified = False

                if 'url' in attrs:
                    new_url = self._map_url(attrs['url'])
                    if new_url != attrs['url']:
                        fixes.append(LinkFix(attrs['url'], new_url, 'gutenberg'))
                        attrs['url'] = new_url
                        modified = True

                if 'href' in attrs:
                    new_url = self._map_url(attrs['href'])
                    if new_url != attrs['href']:
                        fixes.append(LinkFix(attrs['href'], new_url, 'gutenberg'))
                        attrs['href'] = new_url
                        modified = True

                if modified:
                    return json.dumps(attrs)
            except:
                pass
            return match.group(0)

        content = re.sub(
            r'<!-- wp:\w+ ({[^}]+})',
            lambda m: f'<!-- wp:{m.group(0).split()[1]} {replace_gutenberg_url(m)}',
            content
        )

        return content, fixes

    def _map_url(self, url: str) -> str:
        """URLã‚’ãƒãƒƒãƒ”ãƒ³ã‚°"""
        # çµ¶å¯¾URLã‚’ãƒ‘ã‚¹ã«å¤‰æ›
        path = urlparse(url).path

        # ãƒãƒƒãƒ—ã‹ã‚‰æ¤œç´¢
        if path in self.url_map:
            return self.url_map[path]

        # æœ«å°¾ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®æœ‰ç„¡ã‚’æ­£è¦åŒ–ã—ã¦å†æ¤œç´¢
        normalized = path.rstrip('/') if path.endswith('/') else f'{path}/'
        if normalized in self.url_map:
            return self.url_map[normalized]

        return url
```

### 3.6 ACFå®Œå…¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```python
class ACFImporter:
    """ACFãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®Œå…¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""

    # ACFãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ— â†’ Focomyãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—
    TYPE_MAP = {
        # åŸºæœ¬
        'text': 'string',
        'textarea': 'text',
        'number': 'number',
        'range': 'number',
        'email': 'email',
        'url': 'url',
        'password': 'string',

        # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        'wysiwyg': 'blocks',
        'oembed': 'embed',

        # é¸æŠ
        'select': 'select',
        'checkbox': 'multiselect',
        'radio': 'select',
        'button_group': 'select',
        'true_false': 'boolean',

        # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        'link': 'url',  # ã¾ãŸã¯å°‚ç”¨ã® link ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        'post_object': 'relation',
        'page_link': 'relation',
        'relationship': 'relations',
        'taxonomy': 'relations',
        'user': 'relation',

        # ãƒ¡ãƒ‡ã‚£ã‚¢
        'image': 'image',
        'file': 'file',
        'gallery': 'gallery',

        # æ—¥æ™‚
        'date_picker': 'date',
        'date_time_picker': 'datetime',
        'time_picker': 'time',

        # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
        'repeater': 'repeater',
        'flexible_content': 'flexible',
        'group': 'group',
        'clone': 'clone',  # ç‰¹æ®Šå‡¦ç†

        # ãã®ä»–
        'color_picker': 'color',
        'google_map': 'map',
    }

    async def import_field_groups(
        self,
        acf_export: list[dict],
    ) -> list[ContentTypeFragment]:
        """ACFãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""

        fragments = []

        for group in acf_export:
            fields = []

            for acf_field in group.get('fields', []):
                field = await self._convert_field(acf_field)
                if field:
                    fields.append(field)

            fragments.append(ContentTypeFragment(
                name=group.get('key'),
                label=group.get('title'),
                fields=fields,
                location=self._parse_location_rules(group.get('location', [])),
            ))

        return fragments

    async def _convert_field(self, acf_field: dict) -> FieldDef | None:
        """ACFãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’Focomyãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¤‰æ›"""

        acf_type = acf_field.get('type')
        focomy_type = self.TYPE_MAP.get(acf_type)

        if not focomy_type:
            return None

        field = FieldDef(
            name=acf_field.get('name'),
            type=focomy_type,
            label=acf_field.get('label', ''),
            required=acf_field.get('required', False),
            instructions=acf_field.get('instructions', ''),
            default=acf_field.get('default_value'),
        )

        # ã‚¿ã‚¤ãƒ—åˆ¥ã®è¨­å®šå¤‰æ›
        if acf_type == 'text':
            field.max_length = acf_field.get('maxlength')
            field.placeholder = acf_field.get('placeholder')

        elif acf_type == 'number':
            field.min = acf_field.get('min')
            field.max = acf_field.get('max')
            field.step = acf_field.get('step')

        elif acf_type in ('select', 'checkbox', 'radio', 'button_group'):
            field.options = self._parse_choices(acf_field.get('choices', {}))
            field.allow_null = acf_field.get('allow_null', False)

        elif acf_type == 'image':
            field.return_format = acf_field.get('return_format', 'array')
            field.preview_size = acf_field.get('preview_size', 'thumbnail')
            field.library = acf_field.get('library', 'all')
            field.mime_types = acf_field.get('mime_types', '')

        elif acf_type == 'repeater':
            field.min_rows = acf_field.get('min', 0)
            field.max_rows = acf_field.get('max', 0) or None
            field.layout = acf_field.get('layout', 'table')
            field.fields = [
                await self._convert_field(sub)
                for sub in acf_field.get('sub_fields', [])
            ]
            field.fields = [f for f in field.fields if f]  # Noneé™¤å»

        elif acf_type == 'flexible_content':
            field.min_layouts = acf_field.get('min', 0)
            field.max_layouts = acf_field.get('max', 0) or None
            field.layouts = []

            for layout in acf_field.get('layouts', []):
                layout_fields = [
                    await self._convert_field(sub)
                    for sub in layout.get('sub_fields', [])
                ]
                field.layouts.append({
                    'name': layout.get('name'),
                    'label': layout.get('label'),
                    'fields': [f for f in layout_fields if f],
                })

        elif acf_type == 'group':
            field.fields = [
                await self._convert_field(sub)
                for sub in acf_field.get('sub_fields', [])
            ]
            field.fields = [f for f in field.fields if f]

        elif acf_type == 'relationship':
            field.post_type = acf_field.get('post_type', [])
            field.taxonomy = acf_field.get('taxonomy', [])
            field.min = acf_field.get('min', 0)
            field.max = acf_field.get('max', 0) or None

        # æ¡ä»¶ä»˜ããƒ­ã‚¸ãƒƒã‚¯
        if acf_field.get('conditional_logic'):
            field.conditions = self._parse_conditional_logic(
                acf_field['conditional_logic']
            )

        return field

    def _parse_choices(self, choices: dict | list) -> list[dict]:
        """é¸æŠè‚¢ã‚’ãƒ‘ãƒ¼ã‚¹"""
        if isinstance(choices, dict):
            return [
                {'value': k, 'label': v}
                for k, v in choices.items()
            ]
        return choices
```

---

## Phase 4: ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œæ¤œè¨¼

### 4.1 æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

```python
class PostImportValidator:
    """ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã®æ•´åˆæ€§æ¤œè¨¼"""

    async def validate(self, job: ImportJob) -> ValidationReport:
        """ã‚¤ãƒ³ãƒãƒ¼ãƒˆçµæœã‚’æ¤œè¨¼"""

        report = ValidationReport()

        # 1. ä»¶æ•°ãƒã‚§ãƒƒã‚¯
        await self._check_counts(job, report)

        # 2. ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•´åˆæ€§
        await self._check_relations(job, report)

        # 3. ãƒ¡ãƒ‡ã‚£ã‚¢å‚ç…§ãƒã‚§ãƒƒã‚¯
        await self._check_media_references(job, report)

        # 4. å†…éƒ¨ãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯
        await self._check_internal_links(job, report)

        # 5. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯
        await self._check_redirects(job, report)

        # 6. SEOç›£æŸ»ï¼ˆç§»è¡Œå‰å¾Œæ¯”è¼ƒï¼‰
        await self._seo_audit(job, report)

        return report

    async def _seo_audit(self, job: ImportJob, report: ValidationReport):
        """SEOç›£æŸ» - ç§»è¡Œå‰å¾Œã®æ¯”è¼ƒ"""

        audit = SEOAudit()

        # ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜ã®é•·ã•ãƒã‚§ãƒƒã‚¯
        posts = await self.entity_svc.find('post', limit=10000)
        for post in posts:
            data = self.entity_svc.serialize(post)

            # ã‚¿ã‚¤ãƒˆãƒ«é•·
            title = data.get('meta_title') or data.get('title', '')
            if len(title) > 60:
                audit.add_warning(f"Title too long: {title[:50]}...")

            # èª¬æ˜é•·
            desc = data.get('meta_description', '')
            if desc and len(desc) > 160:
                audit.add_warning(f"Description too long for: {data.get('title')}")

            # OGç”»åƒ
            if not data.get('og_image'):
                audit.add_info(f"Missing OG image: {data.get('title')}")

        report.seo_audit = audit
```

### 4.2 æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆUI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†                                                    â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“Š ã‚¤ãƒ³ãƒãƒ¼ãƒˆçµæœ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ç¨®é¡          â”‚ æˆåŠŸ   â”‚ ã‚¹ã‚­ãƒƒãƒ—â”‚ å¤±æ•—   â”‚ æ¤œè¨¼   â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ æŠ•ç¨¿          â”‚ 520    â”‚ 3      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ å›ºå®šãƒšãƒ¼ã‚¸    â”‚ 42     â”‚ 0      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ ãƒ¡ãƒ‡ã‚£ã‚¢      â”‚ 1,845  â”‚ 2      â”‚ 0      â”‚ âš  2ä»¶  â”‚              â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª      â”‚ 28     â”‚ 0      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ ã‚¿ã‚°          â”‚ 156    â”‚ 0      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ ã‚³ãƒ¡ãƒ³ãƒˆ      â”‚ 890    â”‚ 2      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ ãƒ¡ãƒ‹ãƒ¥ãƒ¼      â”‚ 3      â”‚ 0      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â”‚ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ  â”‚ 765    â”‚ 0      â”‚ 0      â”‚ âœ“ OK   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“ˆ SEOç›£æŸ»                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ ã‚¿ã‚¤ãƒˆãƒ«: 520ä»¶ä¸­ 518ä»¶ãŒé©åˆ‡ãªé•·ã•                           â”‚ â”‚
â”‚  â”‚ âš  ã‚¿ã‚¤ãƒˆãƒ«: 2ä»¶ãŒé•·ã™ãã¾ã™ (60æ–‡å­—è¶…)                          â”‚ â”‚
â”‚  â”‚ âœ“ ãƒ¡ã‚¿èª¬æ˜: 480ä»¶è¨­å®šæ¸ˆã¿                                       â”‚ â”‚
â”‚  â”‚ âš  ãƒ¡ã‚¿èª¬æ˜: 40ä»¶ãŒæœªè¨­å®š                                        â”‚ â”‚
â”‚  â”‚ âš  OGç”»åƒ: 15ä»¶ãŒæœªè¨­å®š                                          â”‚ â”‚
â”‚  â”‚                                                      [è©³ç´°ã‚’è¦‹ã‚‹] â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  âš  æ¤œè¨¼è­¦å‘Š (2ä»¶)                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ ãƒ¡ãƒ‡ã‚£ã‚¢ "photo-2023.jpg" ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ã§ã—ãŸ       â”‚ â”‚
â”‚  â”‚   å…ƒURL: https://old-cdn.example.com/photo-2023.jpg             â”‚ â”‚
â”‚  â”‚   â†’ æ‰‹å‹•ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‹ã€æŠ•ç¨¿ã‹ã‚‰å‰Šé™¤ã—ã¦ãã ã•ã„          â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ â€¢ ãƒ¡ãƒ‡ã‚£ã‚¢ "video-promo.mp4" ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ã§ã—ãŸ      â”‚ â”‚
â”‚  â”‚   å…ƒURL: https://old-cdn.example.com/video-promo.mp4            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ­ã‚°                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2024-01-20 15:30:00 - ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹                             â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:30:05 - ã‚«ãƒ†ã‚´ãƒª: 28ä»¶ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†              â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:30:08 - ã‚¿ã‚°: 156ä»¶ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†                 â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:35:22 - ãƒ¡ãƒ‡ã‚£ã‚¢: 1,845ä»¶ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†         â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:42:15 - æŠ•ç¨¿: 520ä»¶ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†                 â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:43:02 - å†…éƒ¨ãƒªãƒ³ã‚¯: 234ä»¶ ä¿®æ­£å®Œäº†                 â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:43:30 - ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: 765ä»¶ ä½œæˆå®Œäº†               â”‚ â”‚
â”‚  â”‚ 2024-01-20 15:44:00 - æ¤œè¨¼å®Œäº†                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  [ãƒ­ã‚°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰]  [æŠ•ç¨¿ä¸€è¦§ã¸]  [ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 5: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¼·åŒ–

### 5.1 ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç”Ÿæˆï¼ˆå®Œå…¨ç‰ˆï¼‰

```python
class RedirectGenerator:
    """å®Œå…¨ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç”Ÿæˆ"""

    def generate_all(
        self,
        wxr_data: WXRData,
        url_map: dict[str, str],
        options: ImportOptions,
    ) -> list[Redirect]:
        """ã™ã¹ã¦ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ç”Ÿæˆ"""

        redirects = []

        # 1. æŠ•ç¨¿ãƒ»ãƒšãƒ¼ã‚¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        redirects.extend(self._generate_content_redirects(wxr_data, url_map))

        # 2. ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
        redirects.extend(self._generate_taxonomy_redirects(wxr_data))

        # 3. æ—¥ä»˜ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
        redirects.extend(self._generate_date_archive_redirects(wxr_data))

        # 4. è‘—è€…ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
        redirects.extend(self._generate_author_redirects(wxr_data))

        # 5. ãƒ•ã‚£ãƒ¼ãƒ‰
        redirects.extend(self._generate_feed_redirects())

        # 6. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
        redirects.extend(self._generate_pagination_redirects())

        # 7. wp-content ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        redirects.extend(self._generate_wp_content_redirects())

        # 8. æ—¢å­˜ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆRedirectionãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã©ï¼‰
        redirects.extend(self._import_existing_redirects(wxr_data))

        # 9. æ¤œç´¢URL
        redirects.append(Redirect(
            from_path='/?s=*',
            to_path='/search?q=$1',
            match_type='regex',
            status_code=301,
        ))

        # 10. ãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ±ä¸€
        if options.normalize_trailing_slash:
            redirects.extend(self._generate_trailing_slash_redirects(url_map))

        return redirects

    def _generate_date_archive_redirects(self, wxr_data: WXRData) -> list[Redirect]:
        """æ—¥ä»˜ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ"""
        redirects = []

        # å¹´æœˆã‚’æŠ½å‡º
        year_months = set()
        for post in wxr_data.posts:
            if post.post_date:
                year_months.add((post.post_date.year, post.post_date.month))

        for year, month in year_months:
            # /2024/01/ â†’ /blog/archive/2024/01
            redirects.append(Redirect(
                from_path=f'/{year}/{month:02d}/',
                to_path=f'/blog/archive/{year}/{month:02d}',
                status_code=301,
            ))

        # å¹´ã®ã¿
        years = {ym[0] for ym in year_months}
        for year in years:
            redirects.append(Redirect(
                from_path=f'/{year}/',
                to_path=f'/blog/archive/{year}',
                status_code=301,
            ))

        return redirects

    def _generate_wp_content_redirects(self) -> list[Redirect]:
        """wp-contentãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ"""
        return [
            # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            Redirect(
                from_path='/wp-content/uploads/(.*)',
                to_path='/uploads/$1',
                match_type='regex',
                status_code=301,
            ),
            # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ»ãƒ†ãƒ¼ãƒã®ã‚¢ã‚»ãƒƒãƒˆï¼ˆ404ã«ï¼‰
            Redirect(
                from_path='/wp-content/plugins/(.*)',
                to_path='/404',
                match_type='regex',
                status_code=410,  # Gone
            ),
            Redirect(
                from_path='/wp-content/themes/(.*)',
                to_path='/404',
                match_type='regex',
                status_code=410,
            ),
            # wp-includes
            Redirect(
                from_path='/wp-includes/(.*)',
                to_path='/404',
                match_type='regex',
                status_code=410,
            ),
            # wp-adminï¼ˆæ„å›³çš„ãªã‚¢ã‚¯ã‚»ã‚¹ã«å¯¾å¿œï¼‰
            Redirect(
                from_path='/wp-admin(.*)',
                to_path='/admin',
                match_type='regex',
                status_code=301,
            ),
            Redirect(
                from_path='/wp-login.php',
                to_path='/admin/login',
                status_code=301,
            ),
        ]
```

---

## Phase 6: é‹ç”¨æ”¯æ´

### 6.1 ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆ

```python
class MigrationChecklistGenerator:
    """ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆ"""

    def generate(self, analysis: AnalysisReport, options: ImportOptions) -> Checklist:
        """ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ"""

        checklist = Checklist()

        # ç§»è¡Œå‰
        checklist.add_section("ç§»è¡Œå‰", [
            CheckItem("WordPressã‚µã‚¤ãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—", required=True),
            CheckItem("Focomyã‚µã‚¤ãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—", required=True),
            CheckItem("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–", required=False),
            CheckItem("DNSã®TTLã‚’çŸ­ç¸® (300ç§’æ¨å¥¨)", required=True),
            CheckItem("CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒ‘ãƒ¼ã‚¸", required=True if analysis.uses_cdn else False),
            CheckItem("Google Search Consoleã§ã‚µã‚¤ãƒˆç§»è¡Œã‚’é€šçŸ¥", required=True),
        ])

        # ç§»è¡Œä¸­
        checklist.add_section("ç§»è¡Œä¸­", [
            CheckItem("ã‚¤ãƒ³ãƒãƒ¼ãƒˆé€²æ—ã‚’ç›£è¦–"),
            CheckItem("ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª"),
            CheckItem("ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çŠ¶æ³ã‚’ç¢ºèª"),
        ])

        # ç§»è¡Œå¾Œ
        checklist.add_section("ç§»è¡Œå¾Œ", [
            CheckItem("ä¸»è¦ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºç¢ºèª", required=True),
            CheckItem("ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤ºç¢ºèª", required=True),
            CheckItem("å†…éƒ¨ãƒªãƒ³ã‚¯ã®å‹•ä½œç¢ºèª", required=True),
            CheckItem("ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®å‹•ä½œç¢ºèª", required=True),
            CheckItem("ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã®å‹•ä½œç¢ºèª", required=True),
            CheckItem("æ¤œç´¢æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª"),
            CheckItem("ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã®ç¢ºèª"),
            CheckItem("Core Web Vitalsã®ãƒã‚§ãƒƒã‚¯"),
        ])

        # DNSåˆ‡ã‚Šæ›¿ãˆ
        checklist.add_section("DNSåˆ‡ã‚Šæ›¿ãˆ", [
            CheckItem("DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ–°ã‚µãƒ¼ãƒãƒ¼ã«å¤‰æ›´", required=True),
            CheckItem("SSLè¨¼æ˜æ›¸ã®ç¢ºèª", required=True),
            CheckItem("æ—§ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¢ºèªï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰"),
        ])

        # ç§»è¡Œå®Œäº†å¾Œ
        checklist.add_section("ç§»è¡Œå®Œäº†å¾Œ", [
            CheckItem("DNSã®TTLã‚’å…ƒã«æˆ»ã™"),
            CheckItem("CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†è¨­å®š"),
            CheckItem("Google Search Consoleã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹çŠ¶æ³ã‚’ç¢ºèª"),
            CheckItem("404ã‚¨ãƒ©ãƒ¼ç›£è¦–ã‚’è¨­å®š", required=True),
            CheckItem("æ—§WordPressã‚µã‚¤ãƒˆã‚’åœæ­¢"),
        ])

        return checklist
```

### 6.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †æ›¸

```python
class RollbackPlanGenerator:
    """ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †æ›¸è‡ªå‹•ç”Ÿæˆ"""

    def generate(self, job: ImportJob) -> RollbackPlan:
        """ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’ç”Ÿæˆ"""

        plan = RollbackPlan()

        plan.add_step(
            "1. Focomyã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹",
            command="focomy maintenance:on",
        )

        plan.add_step(
            "2. ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤",
            command=f"focomy import:rollback {job.id}",
            description="ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å‰Šé™¤ã—ã¾ã™",
        )

        plan.add_step(
            "3. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’å‰Šé™¤",
            command=f"focomy redirects:delete --job={job.id}",
        )

        plan.add_step(
            "4. DNSã‚’æ—§ã‚µãƒ¼ãƒãƒ¼ã«æˆ»ã™",
            description="DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…ƒã®WordPressã‚µãƒ¼ãƒãƒ¼ã«å‘ã‘ã¾ã™",
            manual=True,
        )

        plan.add_step(
            "5. WordPressã‚µã‚¤ãƒˆã‚’å¾©æ—§",
            description="ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰WordPressã‚µã‚¤ãƒˆã‚’å¾©å…ƒã—ã¾ã™",
            manual=True,
        )

        plan.add_step(
            "6. å‹•ä½œç¢ºèª",
            description="æ—§ã‚µã‚¤ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™",
            manual=True,
        )

        return plan
```

### 6.3 é€šçŸ¥é€£æº

```python
class MigrationNotifier:
    """ç§»è¡Œå®Œäº†é€šçŸ¥"""

    async def notify_completion(
        self,
        job: ImportJob,
        result: ImportResult,
        channels: list[str],
    ) -> None:
        """ç§»è¡Œå®Œäº†ã‚’é€šçŸ¥"""

        message = self._build_message(job, result)

        for channel in channels:
            if channel == 'slack':
                await self._notify_slack(message)
            elif channel == 'email':
                await self._notify_email(message)
            elif channel == 'webhook':
                await self._notify_webhook(message)

    def _build_message(self, job: ImportJob, result: ImportResult) -> dict:
        return {
            'title': f"WordPressç§»è¡Œå®Œäº†: {job.site_name}",
            'status': 'success' if not result.errors else 'completed_with_errors',
            'summary': {
                'posts': result.counts.get('post', 0),
                'pages': result.counts.get('page', 0),
                'media': result.counts.get('media', 0),
                'redirects': result.counts.get('redirect', 0),
            },
            'warnings': len(result.warnings),
            'errors': len(result.errors),
            'duration': str(job.completed_at - job.started_at),
            'url': f"/admin/import/{job.id}/report",
        }

    async def _notify_slack(self, message: dict) -> None:
        """Slacké€šçŸ¥"""
        webhook_url = settings.SLACK_WEBHOOK_URL
        if not webhook_url:
            return

        await httpx.post(webhook_url, json={
            'text': f"âœ… {message['title']}",
            'attachments': [{
                'color': 'good' if message['status'] == 'success' else 'warning',
                'fields': [
                    {'title': 'æŠ•ç¨¿', 'value': str(message['summary']['posts']), 'short': True},
                    {'title': 'ãƒšãƒ¼ã‚¸', 'value': str(message['summary']['pages']), 'short': True},
                    {'title': 'ãƒ¡ãƒ‡ã‚£ã‚¢', 'value': str(message['summary']['media']), 'short': True},
                    {'title': 'ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ', 'value': str(message['summary']['redirects']), 'short': True},
                ],
            }],
        })
```

### 6.4 404ã‚¨ãƒ©ãƒ¼ç›£è¦–

```python
class PostMigrationMonitor:
    """ç§»è¡Œå¾Œã®404ã‚¨ãƒ©ãƒ¼ç›£è¦–"""

    async def start_monitoring(self, job: ImportJob, duration_days: int = 30) -> None:
        """404ã‚¨ãƒ©ãƒ¼ç›£è¦–ã‚’é–‹å§‹"""

        # ç›£è¦–ã‚¸ãƒ§ãƒ–ã‚’ç™»éŒ²
        await self.scheduler.add_job(
            self._check_404_errors,
            trigger='interval',
            hours=1,
            args=[job.id],
            end_date=datetime.utcnow() + timedelta(days=duration_days),
        )

    async def _check_404_errors(self, job_id: str) -> None:
        """404ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯"""

        # ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‹ã‚‰404ã‚’æŠ½å‡º
        errors = await self.log_analyzer.get_404_errors(
            since=datetime.utcnow() - timedelta(hours=1)
        )

        if errors:
            # é »å‡ºURLã‚’ç‰¹å®š
            frequent = Counter(e.path for e in errors).most_common(10)

            # ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
            await self.notifier.send_alert({
                'type': '404_errors',
                'job_id': job_id,
                'count': len(errors),
                'frequent_urls': frequent,
            })

            # è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆææ¡ˆ
            suggestions = await self._suggest_redirects(frequent)
            if suggestions:
                await self.notifier.send_suggestion({
                    'type': 'redirect_suggestions',
                    'suggestions': suggestions,
                })
```

### 6.5 Google Search Consoleé€£æº

```python
class SearchConsoleIntegration:
    """Google Search Consoleé€£æº"""

    async def notify_site_move(
        self,
        old_site: str,
        new_site: str,
    ) -> None:
        """ã‚µã‚¤ãƒˆç§»è¡Œã‚’é€šçŸ¥"""

        # Google Search Console APIã‚’ä½¿ç”¨
        # æ³¨: æ‰‹å‹•æ“ä½œãŒå¿…è¦ãªå ´åˆã‚‚ã‚ã‚Šã€ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º

        guide = """
        ## Google Search Console ã‚µã‚¤ãƒˆç§»è¡Œæ‰‹é †

        1. Search Consoleã«ãƒ­ã‚°ã‚¤ãƒ³
        2. æ—§ã‚µã‚¤ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é¸æŠ
        3. [è¨­å®š] > [ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´] ã‚’é¸æŠ
        4. æ–°ã—ã„ã‚µã‚¤ãƒˆã®URLã‚’å…¥åŠ›
        5. æ¤œè¨¼ã‚’å®Ÿè¡Œ

        è©³ç´°: https://support.google.com/webmasters/answer/9370220
        """

        return guide

    async def request_indexing(self, urls: list[str]) -> None:
        """ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç™»éŒ²ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"""

        for url in urls[:50]:  # APIåˆ¶é™
            await self.indexing_api.publish_url(url)
```

### 6.6 CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‘ãƒ¼ã‚¸

```python
class CDNIntegration:
    """CDNé€£æº"""

    async def purge_cache(self, provider: str, options: dict) -> None:
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒ‘ãƒ¼ã‚¸"""

        if provider == 'cloudflare':
            await self._purge_cloudflare(options)
        elif provider == 'fastly':
            await self._purge_fastly(options)
        elif provider == 'akamai':
            await self._purge_akamai(options)

    async def _purge_cloudflare(self, options: dict) -> None:
        """Cloudflareã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒ‘ãƒ¼ã‚¸"""

        async with httpx.AsyncClient() as client:
            await client.post(
                f"https://api.cloudflare.com/client/v4/zones/{options['zone_id']}/purge_cache",
                headers={
                    'Authorization': f"Bearer {options['api_token']}",
                },
                json={'purge_everything': True},
            )
```

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆæœ€çµ‚ç‰ˆï¼‰

```
core/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ wordpress/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ analyzer.py           # ã‚µã‚¤ãƒˆåˆ†æ
â”‚       â”œâ”€â”€ wxr_parser.py         # WXRãƒ‘ãƒ¼ã‚µãƒ¼
â”‚       â”œâ”€â”€ rest_api_client.py    # WP REST APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ direct_db_client.py   # ç›´æ¥DBæ¥ç¶šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ block_converter.py    # Gutenbergãƒ–ãƒ­ãƒƒã‚¯å¤‰æ›
â”‚       â”œâ”€â”€ shortcode_handler.py  # ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å‡¦ç†
â”‚       â”œâ”€â”€ media_downloader.py   # ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
â”‚       â”œâ”€â”€ media_optimizer.py    # ãƒ¡ãƒ‡ã‚£ã‚¢æœ€é©åŒ–ï¼ˆWebPå¤‰æ›ç­‰ï¼‰
â”‚       â”œâ”€â”€ content_converter.py  # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¤‰æ›
â”‚       â”œâ”€â”€ content_sanitizer.py  # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µãƒ‹ã‚¿ã‚¤ã‚º
â”‚       â”œâ”€â”€ acf_importer.py       # ACFã‚¤ãƒ³ãƒãƒ¼ãƒˆ
â”‚       â”œâ”€â”€ multilingual.py       # å¤šè¨€èªå¯¾å¿œï¼ˆWPML/Polylangï¼‰
â”‚       â”œâ”€â”€ url_mapper.py         # URLãƒãƒƒãƒ”ãƒ³ã‚°
â”‚       â”œâ”€â”€ redirect_generator.py # ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç”Ÿæˆ
â”‚       â”œâ”€â”€ link_fixer.py         # å†…éƒ¨ãƒªãƒ³ã‚¯ä¿®æ­£
â”‚       â”œâ”€â”€ diff_detector.py      # å·®åˆ†æ¤œå‡º
â”‚       â”œâ”€â”€ dry_run.py            # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³
â”‚       â”œâ”€â”€ preview.py            # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
â”‚       â”œâ”€â”€ parallel_importer.py  # ä¸¦åˆ—ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
â”‚       â”œâ”€â”€ checkpoint.py         # ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†
â”‚       â”œâ”€â”€ background_job.py     # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–
â”‚       â”œâ”€â”€ job_manager.py        # ã‚¸ãƒ§ãƒ–ç®¡ç†
â”‚       â”œâ”€â”€ validator.py          # ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œæ¤œè¨¼
â”‚       â”œâ”€â”€ seo_audit.py          # SEOç›£æŸ»
â”‚       â”œâ”€â”€ rollback.py           # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
â”‚       â”œâ”€â”€ checklist.py          # ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç”Ÿæˆ
â”‚       â”œâ”€â”€ notifier.py           # é€šçŸ¥é€£æº
â”‚       â”œâ”€â”€ monitor.py            # 404ã‚¨ãƒ©ãƒ¼ç›£è¦–
â”‚       â”œâ”€â”€ search_console.py     # Google Search Consoleé€£æº
â”‚       â””â”€â”€ cdn.py                # CDNé€£æº
â”œâ”€â”€ api/
â”‚   â””â”€â”€ wordpress.py              # API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ templates/
    â””â”€â”€ admin/
        â””â”€â”€ wordpress_import/
            â”œâ”€â”€ index.html        # ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³
            â”œâ”€â”€ source.html       # ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠ
            â”œâ”€â”€ analysis.html     # åˆ†æçµæœ
            â”œâ”€â”€ shortcodes.html   # ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ãƒ¬ãƒãƒ¼ãƒˆ
            â”œâ”€â”€ dry_run.html      # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³çµæœ
            â”œâ”€â”€ preview.html      # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèª
            â”œâ”€â”€ options.html      # ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
            â”œâ”€â”€ progress.html     # é€²æ—è¡¨ç¤º
            â”œâ”€â”€ report.html       # å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ
            â”œâ”€â”€ checklist.html    # ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
            â””â”€â”€ rollback.html     # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª
```

---

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```
lxml>=4.9.0           # XMLãƒ‘ãƒ¼ã‚¹
aiohttp>=3.8.0        # éåŒæœŸHTTP
aiofiles>=23.0.0      # éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ«IO
Pillow>=10.0.0        # ç”»åƒå‡¦ç†
beautifulsoup4>=4.12  # HTML ãƒ‘ãƒ¼ã‚¹
phpserialize>=1.3     # PHPã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå½¢å¼ã®ãƒ‡ã‚³ãƒ¼ãƒ‰
xxhash>=3.0.0         # é«˜é€Ÿãƒãƒƒã‚·ãƒ¥ï¼ˆå·®åˆ†æ¤œå‡ºç”¨ï¼‰
httpx>=0.25.0         # HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆAPIé€£æºï¼‰
pymysql>=1.1.0        # MySQLæ¥ç¶šï¼ˆDirect DBç”¨ï¼‰
aiomysql>=0.2.0       # éåŒæœŸMySQL
```
